<!DOCTYPE html>
<html>
<body>
<style>
ul, #myUL {
  list-style-type: none;
}
* Style the caret/arrow */
.caret {
  cursor: pointer;
  user-select: none; /* Prevent text selection */
}

/* Create the caret/arrow with a unicode, and style it */
.caret::before {
  content: "\25B6";
  color: #999999;
  display: inline-block;
  margin-right: 6px;
}

/* Rotate the caret/arrow icon when clicked on (using JavaScript) */
.caret-down::before {
  transform: rotate(90deg);
}

/* Hide the nested list */
.nested {
  display: none;
}

/* Show the nested list when the user clicks on the caret/arrow (with JavaScript) */
.active {
  display: block;
}
  body {
  background-color: #000000;
  color: #999999;
   }
   div{
  white-space: pre-line;
    font-size:8vw;
  }
  button{
  border: 0.5vw solid #999999; 
 margin:1vw;
 background-color: #333333;
  color: #999999;
    font-size:8vw;
  }
  #myUL{
  border: 0.5vw solid #999999; 
 margin:1vw;
 background-color: #333333;
  color: #999999;
    font-size:2vw;
  }
  .small{
  border: 0.5vw solid #999999; 
 margin:1vw;
 background-color: #333333;
  color: #999999;
    font-size:2vw;
  }
  input{
  border: 0.5vw solid #999999; 
 margin:1vw;
 background-color: #333333;
  color: #999999;
    font-size:2vw;
  }
  select{
  border: 0.5vw solid #999999; 
 margin:1vw;
 background-color: #333333;
  color: #999999;
    font-size:2vw;
  }
  textarea {
  border: 0.5vw solid #333333; 
 	background-color: #999999;
  	color: #333333;
	}
  .footer {
  border: 0.5vw solid #999999; 
 background-color: #336633;
    }
</style>
<!--<input type="file" id="file-selector"\>
<input type="button" onclick="SaveJson()" value="Save"\>
const fileSelector = document.getElementById('file-selector');
  fileSelector.addEventListener('change', (event) => {
    const div = document.getElementById('container');
    var fr=new FileReader();
    fr.onload=function(){
      div.innerHTML = fr.result;
    }
	fr.readAsText(event.target.files[0]);
  });
 function SaveJson()
 {
 var a = document.createElement("a");
 var content = JSON.stringify(book, null, '\t');
	a.href = window.URL.createObjectURL(new Blob([content], {type: "text/plain"}));
a.download = "demo.txt";
a.click();
 }
-->
<input type="button" onclick="ToggleEditor()" value="editor"\>
<div id="editor" class="footer">
</div>
<div id="container">
</div>
<script>
  var book = {};
  var showEditor = false;

  function ToggleEditor()
  {
  	showEditor = !showEditor;
    UpdateEditor();
  }
  function UpdateEditor()
  {
  	if (showEditor)
    {
    	document.getElementById("editor").style.display = "block";
    }
    else
    {
    	document.getElementById("editor").style.display = "none";
    }
  }
  function AddPage(name, text) 
  {
    if (book[name])
     return book[name];
    var page = {};
    page.text = text;
    page.options = {};
    page.Add = function(name, text)
    {
      var oprs = {};
      oprs.text = text;
      page.options[name]  = oprs;
      return page;
    };
    book[name] = page;
    return page;
  }
  function Goto(name) 
  {
    const div = document.getElementById('container');

      const page = book[name];

      div.innerHTML = page.text+"\n";
      for (var key in page.options) {
          div.innerHTML += "<button onclick=\"Goto('"+key+"')\">"+page.options[key].text+"</button>\n";
      }
  }
  function CreateListView(div)
  {
  
    var ul = document.createElement("ul");
  	var add =document.createElement("input");
    var addBtn = document.createElement("button");
    div.appendChild(add);
    div.appendChild(addBtn);
    div.appendChild(ul);
    
    var FillNodeView = function()
    {
    	ul.innerHTML = "";
      for (var key in book) 
      {
          var li = document.createElement("li");
          var span = document.createElement("span");
    	  var ulInner = document.createElement("ul");
          var rem = document.createElement("button");
          var textArea = document.createElement("textarea");
          li.appendChild(span);
          li.appendChild(rem);
          li.appendChild(ulInner);
          ul.appendChild(li);
          
    	   
          var page = book[key];
      
          span.innerHTML = key;
          span.className="caret";
          span.addEventListener("click", function() {
            this.parentElement.querySelector(".nested").classList.toggle("active");
            this.classList.toggle("caret-down");
          });
          ulInner.className="nested";

          textArea.value = page.text;
              rem.innerHTML = "REM";
              rem.className="small";
              rem.onClick = function() {

              };
          
          ulInner.appendChild(textArea);
        }
    }
    
    addBtn.innerHTML = "ADD";
    addBtn.className="small";
    addBtn.onClick = function() {
    	var name = add.value.trim();
    	if (name.length)
        {
           	AddPage(name, "");
            FillNodeView();
            
        }
    };
  	ul.id = "myUL";
   	add.type = "text";
    FillNodeView();
    
  }
  function SetupEditor()
  {
    const div = document.getElementById('editor');
    div.innerHTML = "";
    CreateListView(div);
    var selectList = document.createElement("select");
    selectList.id = "mySelect";
    div.appendChild(selectList);

    for (var key in book) {
      	var option = document.createElement("option");
        option.value = key;
        option.text = key;
        selectList.appendChild(option);
    }
    
    var x = document.createElement("textarea");
  	
  	x.value = book[selectList.value].text;
  	div.appendChild(x);
    selectList.onchange = function(){
    	x.value = book[selectList.value].text;	
        Goto(selectList.value);
    };
    
    x.onchange = function(){
    	book[selectList.value].text = x.value;
        Goto(selectList.value);	
    };
    UpdateEditor();
  }
  function SetDefault()
  {
    	book = {};
    	AddPage("start", "Knack Knack!\nDet knackar på dörren").Add("door", "öppna dörren").Add("window", "titta genom fönstret");
		AddPage("door", "Ingen där!").Add("start", "stäng dörren");
		AddPage("window", "Det står något stort utanför").Add("door", "öppna ändå");
      Goto("start");
  }
	SetDefault();
    SetupEditor();
</script>
</body>
</html>
